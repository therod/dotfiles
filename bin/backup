#!/bin/sh
IFS=$'\n'

# Copies a few key files to a mounted sparsebundle which is then stored in Dropbox.

# Your sparsebundle.
sparsebundle="/Volumes/Eddie/Archive/sparsebackup.sparsebundle"

# Your destination. My sparsebundle mounts to "backup".
backup_location="/Volumes/sparsebackup"

# Directories to backup. Recursive, implied home (~) location.
directories=(
  "code"
  ".ssh"
  ".localrc"
  ".dotfiles"
  ".heroku"
  ".zsh_history"
  ".offlineimaprc"
  "./Library/Application Support/Evernote"
)

hdiutil attach -noverify $sparsebundle

for directory in ${directories[@]}
  do
    rsync -avh --progress --delete ~/$directory $backup_location
done

hdiutil detach $backup_location

#
# E-Mail Backup
#

# Sync all emails from gmail to a sparsebundle called gmail-backup.sparsebundle
gmail_sparsebundle="/Volumes/Eddie/Archive/gmail-backup.sparsebundle"

# Your destination. My gmail-sparsebundle mounts to "gmail-backup".
mail_backup_location="/Volumes/gmail-backup"

# Attach the sparsebundle
hdiutil attach -noverify $gmail_sparsebundle

# Run offlineimap. Important: Configuration is stored in ~/.offlineimaprc
offlineimap

hdiutil detach $mail_backup_location
